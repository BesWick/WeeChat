@using System.Web.UI.WebControls
@model WeeChat.ViewModels.ContactViewModel
@{
    ViewBag.Title = "List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2> Contacts(@Model.users.Count())</h2>

<div class="list-group">
    @foreach (var user in Model.users )
    {

    <a href="@Url.Action("Index", "Conversation", new {id = user.ScreenName})"
       class="list-group-item d-flex justify-content-between align-items-center">
        @user.ScreenName
        <span class="badge" id = @user.ScreenName> </span>

    </a>

    }
</div>


@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.4.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script>
        $(function() {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;

            var users = @Html.Raw(Json.Encode(Model.users));

            $.each(users,
                function(index, value) {
                    if (value.IsConnected) {
                        console.log("if" + value.ScreenName);
                        $('#' + value.ScreenName).addClass('active');
                    } else {
                        console.log("else" + value.ScreenName);
                        $('#' + value.ScreenName).removeClass('active');
                    }
                });




            chat.client.setOnline = function (name) {
                console.log("connecteddd:" + name);

                $('#' + name).addClass('active');

            };


            chat.client.setOffline = function(name) {
                console.log("Offline now");
                $('#' + name).removeClass('active');
            };

            $.connection.hub.start()
                .done(function(){ console.log('Now connected, connection ID=' + $.connection.hub.id); })
                .fail(function(){ console.log('Could not Connect!'); });

            
        });

       

    </script>
}